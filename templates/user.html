{% include 'header.html' %}
<body>
    <section class="header">
        <div class="ui fluid container">
        </div>
    </section>

    {% if uInfo.full_name %}
        <h1>Name: {{ uInfo.full_name }}</h1>
    {% endif %}

    <img class="profile-picture" src="../profile_picture/{{ username }}" />

    {% if uInfo.email %}
        <h2>Email: {{ uInfo.email }}</h2>
    {% endif %}

    <div class="ui fluid container">
        {% if mInfo %}
            <h1>Mates</h1>
            <div class="ui doubling grid">
            {% for mate in mInfo %}
            {% set rowInfo = dictFromRow( mate ) %}
            <div class="column mate">
                <div class="image">
                    <a class="ui" href="{{ rowInfo.mateID }}" data-tooltip="{{ getInfo( rowInfo.mateID, 'full_name' ) }}">
                        <img class="mate-picture" src="../profile_picture/{{ rowInfo.mateID }}" />
                    </a>
                </div>
            </div>
            {% endfor %}
            </div>
        {% endif %}
    </div>

    <div class="ui search">
        <div class="ui icon input">
            <input class="prompt" type="text" placeholder="Search posts...">
            <i class="search icon"></i>
        </div>
        <div class="results"></div>
    </div>
    <div class="ui segment">
        <div class="ui left rail">
            <div class="ui segment">
            <h1>Please display bro?</h1>
            </div>
        </div>
    <div class="ui text container">
        <div class="ui cards">
            {% for post in pInfo %}
            {% set rowInfo = dictFromRow( post ) %}
            <div class="ui raised fluid card post" id="post-{{ rowInfo.pID }}">
                <div class="content">
                    <div class="right floated author">
                        <img class="ui avatar image" src="../profile_picture/{{ rowInfo.zID }}"> {{ username }}
                    </div>
                    <div class="description">
                        <p>{{ rowInfo.message|doMention|safe }}</p>
                        <span class="right floated time">{{ rowInfo.time}}</span>
                    </div>
                </div>
                <div class="extra content">
                    <div class="ui comments">
                        {% set rs = getPost( rowInfo.pID, 'Comment' ) %}
                        {% if rs|length > 0 %}
                        <h3 class="ui dividing header">Comments</h3>
                        {% else %}
                        <h3>ADD SOME COMMENTS</h3>
                        {% endif %}
                        {% set counter = [ ] %}
                        {% for comment in rs %}
                        {% set row_Info = dictFromRow( comment ) %}
                        {% if counter.append('1') %}{% endif %}
                        <div class="comment">
                            <a class="avatar">
                                <img src="../profile_picture/{{ row_Info.zID}}">
                            </a>
                            <div class="content">
                                <a href="{{ row_Info.zID }}" class="author">{{ getInfo( row_Info.zID, "full_name" )}}</a>
                                <div class="metadata">
                                    <span class="date">{{ row_Info.time }}</span>
                                </div>
                                <div class="text">{{ row_Info.message|doMention|safe }}</div>
                                <div class="actions">
                                    <a class="reply">Reply</a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        {% if counter|length > 4 %}
                        <button data-toggle="{{ rowInfo.pID }}" class="mini ui grey button toggle_comments">Show more comments.</button>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

    {% if username == getSess( ) %}
        {% if uInfo.courses %}
            <p>Courses: {{ uInfo.courses }}</p>
        {% endif %}
        {% if uInfo.password %}
            <p>Password: {{ uInfo.password }}</p>
        {% endif %}
    {% endif %}
    <textarea>{{ uInfo|string }}</textarea>
    <textarea>{{ pInfo|string }}</textarea>

    <script>

    var content = [
        {% for post in pInfo %}
        {% set rowInfo = dictFromRow( post ) %}
        {title: '{{ rowInfo.message }}', action: '{{ rowInfo.pID }}'},
        {% endfor %}
      // etc
    ];
    $('.ui.search').search({
        source: content,
        maxResults: 3,
        minCharacters: 3,
        onSelect: function(result, response) {
            $('html, body').animate({        // Scroll to Result
                scrollTop: $( "#post-" + result[ 'action' ] ).offset().top
            }, 250 );
            $( ".prompt" ).val( "" );        // Reset field
            return false;
        }
    });

    $( '.toggle_comments' ).on( 'click', function( ) {
        var pID = $( this ).data( "toggle" )
        var text = $( this ).text( );
        console.log( text );
        if( text == "Show more comments." ) {
            $( this ).text( "Hide comments." );
        } else {
            $( this ).text( "Show more comments." );
            $('html, body').animate({        // Scroll to Result
                scrollTop: $( "#post-" + pID ).offset().top
            }, 500 );
        }
        $( "#post-" + pID + " div:nth-child(n+6)").toggle( "500" );
    });
    </script>

</body>
</html>
