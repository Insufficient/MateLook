{% include 'header.html' %}
<body>
    <section class="header">
        <div class="ui fluid container">
        </div>
    </section>

    {% if uInfo.full_name %}
        <h1>Name: {{ uInfo.full_name }}</h1>
    {% endif %}

    <img class="profile-picture" src="../profile_picture/{{ username }}" />

    {% if uInfo.email %}
        <h2>Email: {{ uInfo.email }}</h2>
    {% endif %}

    {% if uInfo.mates %}
        <h2>Mates:</h2>
        {% for mate in uInfo.mates %}
            <li class="mate">
                <a href="{{mate}}" class="mate-name">{{ getInfo( mate, "full_name" ) }}</a>
                <!-- <img class="mate_picture" src="../{{ img }}/../../{{ mate }}/profile.jpg" /> -->
                <img class="mate-picture" src="../profile_picture/{{ mate }}" />
            </li>
        {% endfor %}
    {% endif %}

    <!-- <section class="posts">
    {% for post in pInfo %}
        {% set rowInfo = dictFromRow( post ) %}
        <h3>From: {{ rowInfo.zID }}</h3>
        <h4>Message: {{ rowInfo.message|doMention|safe }}</h4>
    {% endfor %}
    </section> -->

    <h1>Mates</h1>
    {% for mate in mInfo %}
    {% set rowInfo = dictFromRow( mate ) %}
    <li class="mate">
        <a href="{{ rowInfo.mateID }}" class="mate-name">{{ getInfo( rowInfo.mateID, "full_name" ) }}</a>
        <!-- <img class="mate_picture" src="../{{ img }}/../../{{ mate }}/profile.jpg" /> -->
        <img class="mate-picture" src="../profile_picture/{{ rowInfo.mateID }}" />
    </li>
    {% endfor %}

    <div class="ui search">
        <div class="ui icon input">
            <input class="prompt" type="text" placeholder="Search posts...">
            <i class="search icon"></i>
        </div>
        <div class="results"></div>
    </div>

    <section class="ui raised very padded text container segment">
        <div class="ui comments">
            <h2 class="ui dividing header">Posts</h2>
            {% for post in pInfo %}
            {% set rowInfo = dictFromRow( post ) %}
            <div class="comment" id="comment-{{ loop.index }}">
                <a class="avatar">
                    <img src="../profile_picture/{{ username }}" />
                </a>
                <div class="content">
                    <a class="author">{{ rowInfo.zID }}</a>
                    <div class="metadata">
                        <span class="date">{{ rowInfo.time}}</span>
                    </div>
                    <div class="text">
                        {{ rowInfo.message|doMention|safe }}
                    </div>
                    <div class="actions">
                        <a class="reply">Reply</a>
                        <a class="action-edit">Edit</a>
                        <a class="action-delete">Erase</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    {% if username == getSess( ) %}
        {% if uInfo.courses %}
            <p>Courses: {{ uInfo.courses }}</p>
        {% endif %}
        {% if uInfo.password %}
            <p>Password: {{ uInfo.password }}</p>
        {% endif %}
    {% endif %}
    <textarea>{{ uInfo|string }}</textarea>
    <textarea>{{ pInfo|string }}</textarea>

    <script>

    $('.ui.form')
        .form({
            fields: {
                zID: {
                    rules: [{
                        type: 'regExp',
                        value: /z[0-9]{7}/i,
                        prompt: 'Please enter a valid zID.'
                    }]
                },
                password: {
                    rules: [{
                        type   : 'minLength[4]',
                        prompt: 'Please enter at least FOUR characters for your password.'
                    }]
                }
        }
    })
    ;

    var content = [
        {% for post in pInfo %}
        {% set rowInfo = dictFromRow( post ) %}
        {title: '{{ rowInfo.message }}', action: '{{ loop.index }}'},
        {% endfor %}
      // etc
    ];
    $('.ui.search').search({
        source: content,
        maxResults: 3,
        minCharacters: 3,
        onSelect: function(result, response) {
            $('html, body').animate({        // Scroll to Result
                scrollTop: $( "#comment-" + result[ 'action' ] ).offset().top
            }, 250 );
            $( ".prompt" ).val( "" );        // Reset field
            return false;
        }
    });
    </script>

</body>
</html>
